<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This function splits the data set into a train &amp;amp; test set,
trains machine learning (ML) models using k-fold cross-validation,
evaluates the best model on the held-out test set,
and optionally calculates feature importance using the framework
outlined in Topçuoğlu et al. 2020 (doi:10.1128/mBio.00434-20
).
Required inputs are a data frame (must contain an outcome variable and all
other columns as features) and the ML method.
See vignette('introduction') for more details."><title>Run the machine learning pipeline — run_ml • mikropml</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Run the machine learning pipeline — run_ml"><meta property="og:description" content="This function splits the data set into a train &amp;amp; test set,
trains machine learning (ML) models using k-fold cross-validation,
evaluates the best model on the held-out test set,
and optionally calculates feature importance using the framework
outlined in Topçuoğlu et al. 2020 (doi:10.1128/mBio.00434-20
).
Required inputs are a data frame (must contain an outcome variable and all
other columns as features) and the ML method.
See vignette('introduction') for more details."><meta property="og:image" content="http://www.schlosslab.org/mikropml/logo.png"><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mikropml</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.5.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Paper</h6>
    <a class="dropdown-item" href="../articles/paper.html">mikropml: User-Friendly R Package for Supervised Machine Learning Pipelines</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Vignettes</h6>
    <a class="dropdown-item" href="../articles/introduction.html">Introduction to mikropml</a>
    <a class="dropdown-item" href="../articles/preprocess.html">Preprocessing data</a>
    <a class="dropdown-item" href="../articles/tuning.html">Hyperparameter tuning</a>
    <a class="dropdown-item" href="../articles/parallel.html">Parallel processing</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/SchlossLab/mikropml/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Run the machine learning pipeline</h1>
      <small class="dont-index">Source: <a href="https://github.com/SchlossLab/mikropml/blob/HEAD/R/run_ml.R" class="external-link"><code>R/run_ml.R</code></a></small>
      <div class="d-none name"><code>run_ml.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function splits the data set into a train &amp; test set,
trains machine learning (ML) models using k-fold cross-validation,
evaluates the best model on the held-out test set,
and optionally calculates feature importance using the framework
outlined in Topçuoğlu <em>et al.</em> 2020 (<a href="https://doi.org/10.1128/mBio.00434-20" class="external-link">doi:10.1128/mBio.00434-20</a>
).
Required inputs are a data frame (must contain an outcome variable and all
other columns as features) and the ML method.
See <code><a href="../articles/introduction.html">vignette('introduction')</a></code> for more details.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">run_ml</span><span class="op">(</span></span>
<span>  <span class="va">dataset</span>,</span>
<span>  <span class="va">method</span>,</span>
<span>  outcome_colname <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  hyperparameters <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  find_feature_importance <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  calculate_performance <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  kfold <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  cv_times <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  cross_val <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  training_frac <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  perf_metric_function <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  perf_metric_name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  groups <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  group_partitions <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  corr_thresh <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>dataset</dt>
<dd><p>Data frame with an outcome variable and other columns as features.</p></dd>


<dt>method</dt>
<dd><p>ML method.
Options: <code>c("glmnet", "rf", "rpart2", "svmRadial", "xgbTree")</code>.</p><ul><li><p>glmnet: linear, logistic, or multiclass regression</p></li>
<li><p>rf: random forest</p></li>
<li><p>rpart2: decision tree</p></li>
<li><p>svmRadial: support vector machine</p></li>
<li><p>xgbTree: xgboost</p></li>
</ul></dd>


<dt>outcome_colname</dt>
<dd><p>Column name as a string of the outcome variable
(default <code>NULL</code>; the first column will be chosen automatically).</p></dd>


<dt>hyperparameters</dt>
<dd><p>Dataframe of hyperparameters
(default <code>NULL</code>; sensible defaults will be chosen automatically).</p></dd>


<dt>find_feature_importance</dt>
<dd><p>Run permutation importance (default: <code>FALSE</code>).
<code>TRUE</code> is recommended if you would like to identify features important for
predicting your outcome, but it is resource-intensive.</p></dd>


<dt>calculate_performance</dt>
<dd><p>Whether to calculate performance metrics (default: <code>TRUE</code>).
You might choose to skip this if you do not perform cross-validation during model training.</p></dd>


<dt>kfold</dt>
<dd><p>Fold number for k-fold cross-validation (default: <code>5</code>).</p></dd>


<dt>cv_times</dt>
<dd><p>Number of cross-validation partitions to create (default: <code>100</code>).</p></dd>


<dt>cross_val</dt>
<dd><p>a custom cross-validation scheme from <code><a href="https://rdrr.io/pkg/caret/man/trainControl.html" class="external-link">caret::trainControl()</a></code>
(default: <code>NULL</code>, uses <code>kfold</code> cross validation repeated <code>cv_times</code>).
<code>kfold</code> and <code>cv_times</code> are ignored if the user provides a custom cross-validation scheme.
See the <code><a href="https://rdrr.io/pkg/caret/man/trainControl.html" class="external-link">caret::trainControl()</a></code> docs for information on how to use it.</p></dd>


<dt>training_frac</dt>
<dd><p>Fraction of data for training set (default: <code>0.8</code>). Rows
from the dataset will be randomly selected for the training set, and all
remaining rows will be used in the testing set. Alternatively, if you
provide a vector of integers, these will be used as the row indices for the
training set. All remaining rows will be used in the testing set.</p></dd>


<dt>perf_metric_function</dt>
<dd><p>Function to calculate the performance metric to
be used for cross-validation and test performance. Some functions are
provided by caret (see <code><a href="https://rdrr.io/pkg/caret/man/postResample.html" class="external-link">caret::defaultSummary()</a></code>).
Defaults: binary classification = <code>twoClassSummary</code>,
multi-class classification = <code>multiClassSummary</code>,
regression = <code>defaultSummary</code>.</p></dd>


<dt>perf_metric_name</dt>
<dd><p>The column name from the output of the function
provided to perf_metric_function that is to be used as the performance metric.
Defaults: binary classification = <code>"ROC"</code>,
multi-class classification = <code>"logLoss"</code>,
regression = <code>"RMSE"</code>.</p></dd>


<dt>groups</dt>
<dd><p>Vector of groups to keep together when splitting the data into
train and test sets. If the number of groups in the training set is larger
than <code>kfold</code>, the groups will also be kept together for cross-validation.
Length matches the number of rows in the dataset (default: <code>NULL</code>).</p></dd>


<dt>group_partitions</dt>
<dd><p>Specify how to assign <code>groups</code> to the training and
testing partitions (default: <code>NULL</code>). If <code>groups</code> specifies that some
samples belong to group <code>"A"</code> and some belong to group <code>"B"</code>, then setting
<code>group_partitions = list(train = c("A", "B"), test = c("B"))</code> will result
in all samples from group <code>"A"</code> being placed in the training set, some
samples from <code>"B"</code> also in the training set, and the remaining samples from
<code>"B"</code> in the testing set. The partition sizes will be as close to
<code>training_frac</code> as possible. If the number of groups in the training set is
larger than <code>kfold</code>, the groups will also be kept together for
cross-validation.</p></dd>


<dt>corr_thresh</dt>
<dd><p>For feature importance, group correlations
above or equal to <code>corr_thresh</code> (range <code>0</code> to <code>1</code>; default: <code>1</code>).</p></dd>


<dt>seed</dt>
<dd><p>Random seed (default: <code>NA</code>).
Your results will only be reproducible if you set a seed.</p></dd>


<dt>...</dt>
<dd><p>All additional arguments are passed on to <code><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">caret::train()</a></code>, such as
case weights via the <code>weights</code> argument or <code>ntree</code> for <code>rf</code> models.
See the <code><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">caret::train()</a></code> docs for more details.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Named list with results:</p><ul><li><p><code>trained_model</code>: Output of <code><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">caret::train()</a></code>, including the best model.</p></li>
<li><p><code>test_data</code>: Part of the data that was used for testing.</p></li>
<li><p><code>performance</code>: Data frame of performance metrics. The first column is the
cross-validation performance metric, and the last two columns are the ML
method used and the seed (if one was set), respectively.
All other columns are performance metrics calculated on the test data.
This contains only one row, so you can easily combine performance
data frames from multiple calls to <code>run_ml()</code>
(see <code><a href="../articles/parallel.html">vignette("parallel")</a></code>).</p></li>
<li><p><code>feature_importance</code>: If feature importances were calculated, a data frame
where each row is a feature or correlated group. The columns are the
performance metric of the permuted data, the difference between the true
performance metric and the performance metric of the permuted data
(true - permuted), the feature name, the ML method,
the performance metric name, and the seed (if provided).
For AUC and RMSE, the higher perf_metric_diff is, the more important that
feature is for predicting the outcome. For log loss, the lower
perf_metric_diff is, the more important that feature is for
predicting the outcome.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="more-details">More details<a class="anchor" aria-label="anchor" href="#more-details"></a></h2>
    


<p>For more details, please see
<a href="http://www.schlosslab.org/mikropml/articles/">the vignettes</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Begüm Topçuoğlu, <a href="mailto:topcuoglu.begum@gmail.com">topcuoglu.begum@gmail.com</a></p>
<p>Zena Lapp, <a href="mailto:zenalapp@umich.edu">zenalapp@umich.edu</a></p>
<p>Kelly Sovacool, <a href="mailto:sovacool@umich.edu">sovacool@umich.edu</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># regression</span></span></span>
<span class="r-in"><span><span class="fu">run_ml</span><span class="op">(</span><span class="va">otu_small</span>, <span class="st">"glmnet"</span>,</span></span>
<span class="r-in"><span>  seed <span class="op">=</span> <span class="fl">2019</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># random forest w/ feature importance</span></span></span>
<span class="r-in"><span><span class="fu">run_ml</span><span class="op">(</span><span class="va">otu_small</span>, <span class="st">"rf"</span>,</span></span>
<span class="r-in"><span>  outcome_colname <span class="op">=</span> <span class="st">"dx"</span>,</span></span>
<span class="r-in"><span>  find_feature_importance <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># custom cross validation &amp; hyperparameters</span></span></span>
<span class="r-in"><span><span class="fu">run_ml</span><span class="op">(</span><span class="va">otu_mini_bin</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">11</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  <span class="st">"glmnet"</span>,</span></span>
<span class="r-in"><span>  outcome_colname <span class="op">=</span> <span class="st">"Otu00001"</span>,</span></span>
<span class="r-in"><span>  seed <span class="op">=</span> <span class="fl">2019</span>,</span></span>
<span class="r-in"><span>  hyperparameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1e-04</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  cross_val <span class="op">=</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html" class="external-link">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  calculate_performance <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://github.com/BTopcuoglu" class="external-link">Begüm Topçuoğlu</a>, <a href="https://github.com/zenalapp" class="external-link">Zena Lapp</a>, <a href="https://github.com/kelly-sovacool" class="external-link">Kelly Sovacool</a>, Evan Snitkin, Jenna Wiens, <a href="https://github.com/pschloss" class="external-link">Patrick Schloss</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

